Зададим размер heap для программы MemTracker (с реализацией хранилища в памяти).
-Xmx10m -Xms10m

Анализа памяти виртуальной машины выполним через jconsole. (рис 3, 3.1)
Показания программы следующие: используется Heap - 3,4  mb, classes - 2 300
Heap Memory Poll G1 Old Gen - 3 мб - в области heap для храниения долгоживущих обьектов.(25 %)

Выполним добавление 10000 элементов.(рис 4, 4.1)
Показания программы следующие: Heap memory увеличивается до 5,5 mb, колличество классов увеличилось до 2 330
Heap Memory Poll G1 Old Gen - 5,5 мб - в области heap для храниения долгоживущих обьектов увеличилась.(50 %)

Выполним удаление 9000 элементов.(рис 5)
Показания программы следующие: Heap memory уменьшилась до 4,2 mb и падает до 4,5 mb, колличество классов 2 380
Heap Memory Poll G1 Old Gen - 3,9 мб - в области heap для храниения долгоживущих обьектов увеличилась.(50 %)

Выполним добавление 30000 элементов.(рис 6)
Показания программы следующие: Heap memory увеличивается до 8,2 mb, колличество классов увеличилось до 2 360
Heap Memory Poll G1 Old Gen - 8,2 мб - в области heap для храниения долгоживущих обьектов увеличилась.(75 %)

Выполним добавление 20000 элементов.(рис 7) и добьемся состояния выхода за пределы памяти heap.(рис 7, 7.1)
Видим исключение: Exception in thread "main" java.lang.OutOfMemoryError:
Java heap space: failed reallocation of scalar replaced objects
Стороння программа перестает работать. Выдеоенной памяти heap недостаточно.


